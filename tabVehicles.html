<?php
$min = 100;
$max = 90000;

if (! empty($_POST['min_price'])) {
    $min = $_POST['min_price'];
}

if (! empty($_POST['max_price'])) {
    $max = $_POST['max_price'];
}



?>

<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Local Manager Account">
    <title>All Vehicles</title>
    <link rel="icon" type="image/png" href="images/caricon.png">
    <link rel="stylesheet" type=text/css href="styles/main.css">
    <link rel="stylesheet" type="text/css" href="styles/bootstrap4/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="styles/util.css">
    <link rel="stylesheet" type="text/css" href="styles/style.css">
    <link rel="stylesheet" type="text/css" href="styles/tablesort.css">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="styles/tablesort.js"></script>
</head>

<body>
    <?php session_start(); ?>

    <header>
        <div id="logo"><a><img src="images/logo.png"></a></div>
        <nav>
            <ul>
                <?php
                    if(isset($_SESSION['customer']))
                    {
                        echo '<li><a href="logout.php">Logout</a></li>';
                        echo '<li><a href="custAccount.html" style=text-decoration:none;>Welcome ' . $_SESSION['fname'] . '</a></li>';
                    } else if(isset($_SESSION['wsmanager']) || isset($_SESSION['ldmanager1']) || isset($_SESSION['ldmanager2']) ||                    isset($_SESSION['salesrep1']) || isset($_SESSION['salesrep2']))
                    {
                        echo '<li><a href="logout.php">Logout</a></li>';
                        echo '<li><a href="empAccount.html" style=text-decoration:none;>Welcome ' . $_SESSION['fname'] . '</a></li>';
                    } else
                    {
                        echo '<li>';
                            echo '<a style=color:red;>Sign In</a>';
                                echo '<ul class="dropdown">';
                                    echo '<li><a href="signIn.html">Customers</a></li>';
                                    echo '<li><a href="empSignin.html">Employees</a></li>';
                                echo '</ul>';
                        echo '</li>';
                        echo '<li><a href="registerPage.html">Register</a></li>';
                    }
                ?>
                <li><a>|</a></li>
                <li><a href="contactUs.html">Contact Us</a></li>
                <li><a href="tabVehicles.html">Vehicles</a></li>
                <li><a href="tabPackages.html">Packages</a></li>
                <li><a href="tabRebates.html">Rebates</a></li>
                <li><a href="index.html">Home</a></li>
            </ul>
        </nav>

        <div class="services">
            <div class="container">
                <div class="row">
                    <div class="col text-center">
                        <div class="section_title">View All Vehicles</div>
                        <div class="section_subtitle">It's all in the tables</div>
                    </div>
                </div>
            </div>
        </div>
    </header>



    <div class="form-price-range-filter">
        <form method="post" action="">
            <div>
                <input type="" id="min" name="min_price" value="<?php echo $min; ?>">
                <div id="slider-range"></div>
                <input type="" id="max" name="max_price" value="<?php echo $max; ?>">
            </div>
            <div>
                <input type="submit" name="submit_range" value="Filter Product" class="btn-submit">
            </div>
        </form>
    </div>



    <!-- Cars in the database for dealer -->
    <?php

        $dbconnect = mysqli_connect("127.0.0.1", "root", "", "globalviews");

      // $query1 = "SELECT * FROM available_auto INNER JOIN rebate_global ON available_auto.model = rebate_Global.model AND available_auto.dealer = rebate_Global.dealer";


        $query2 = "SELECT serial_no, color, warehouse, rebate, dealer, model.model, model.price, model.type, model.gas_mileage, model.seat, model.engine FROM available_auto INNER JOIN model ON globalviews.available_auto.model= globalviews.model.model WHERE model.price BETWEEN '$min' AND '$max'";


       $output2 = $dbconnect->query($query2);

        //Find the top N most popular column input
        if(isset($_POST['column']) && isset($_POST['order']))
        {
            $order = $_POST['order'];
            $column = $_POST['column'];

            $query2 = "SELECT serial_no, color, warehouse, rebate, dealer, model.model, model.price, model.type, model.gas_mileage, model.seat, model.engine FROM available_auto INNER JOIN model ON globalviews.available_auto.model= globalviews.model.model where model.price BETWEEN '$min' AND '$max' ORDER BY `$column` $order";

            $output2 = $dbconnect->query($query2);
        }

        if ($_SERVER["REQUEST_METHOD"] == "POST")
        {
           if(isset($_POST['color']) && isset($_POST['model'])&& isset($_POST['gas_mileage'])&& isset($_POST['seat']) && isset($_POST['engine']))
            {
            // collect value of input field
            $color = $_POST['color'];
            $model = $_POST['model'];
            $mileage = $_POST['gas_mileage'];
            $seat = $_POST['seat'];
            $engine = $_POST['engine'];
            }


            if(isset($model) || isset($color) || isset($mileage) || isset($seat) || isset($engine))
            {
                $query2 = "SELECT serial_no, color, warehouse, rebate, dealer, model.model, model.price, model.type, model.gas_mileage, model.seat, model.engine FROM available_auto INNER JOIN model ON globalviews.available_auto.model= globalviews.model.model WHERE color LIKE '$color' OR model.model LIKE '$model' OR gas_mileage LIKE '$mileage' OR seat LIKE '$seat' OR engine LIKE '$engine'";

                $output2 = $dbconnect->query($query2);
            }
        }

    ?>



    Rebate: <input type="checkbox" id="myCheck">


    <div class="limiter">
        <div class="container-table100">
            <div class="wrap-table100">
                <?php if($output2){ ?>
                <form method="POST" style="text-align: center">
                    <select style="width:30%;display:inline-block" class="wrap-input100" name="column">
                        <option value="" disabled selected>Sort By</option>
                        <option value="price">Price</option>
                        <option value="gas_mileage">Gas Mileage</option>
                        <option value="engine">Engine</option>
                        <option value="color">Color</option>
                        <option value="model">Model</option>
                        <span class="focus-input100-1"></span>
                        <span class="focus-input100-2"></span>
                    </select>

                    <select style="width:30%;display:inline-block" class="wrap-input100" name="order">
                        <option value="" disabled selected>Order By</option>
                        <option value="DESC">High to Low</option>
                        <option value="ASC">Low to High</option>
                        <option value="DESC">Z-A</option>
                        <option value="ASC">A-Z</option>
                        <span class="focus-input100-1"></span>
                        <span class="focus-input100-2"></span>
                    </select>

                    <input style="padding: 10px;" type="submit" name="submit" value="Submit" class="btn-submit">
                </form>

                <br>

                <form method="POST" action= "<?php echo $_SERVER['PHP_SELF'];?>">
                    <div style="width:30%;display:inline-block" class="wrap-input100">
                        <input class="input100" type="text" name="color" placeholder="Search Color">
                        <span class="focus-input100-1"></span>
                        <span class="focus-input100-2"></span>
                    </div>

                    <div style="width:30%;display:inline-block" class="wrap-input100">
                        <input class="input100" type="text" name="model" placeholder="Search Model">
                        <span class="focus-input100-1"></span>
                        <span class="focus-input100-2"></span>
                    </div>

                    <div style="width:30%;display:inline-block" class="wrap-input100">
                        <input class="input100" type="text" name="gas_mileage" placeholder="Search Gas Mileage">
                        <span class="focus-input100-1"></span>
                        <span class="focus-input100-2"></span>
                    </div>

                    <div style="width:30%;display:inline-block" class="wrap-input100">
                        <input class="input100" type="text" name="seat" placeholder="Search Seats">
                        <span class="focus-input100-1"></span>
                        <span class="focus-input100-2"></span>
                    </div>

                    <div style="width:30%;display:inline-block" class="wrap-input100">
                        <input class="input100" type="text" name="engine" placeholder="Search Engine">
                        <span class="focus-input100-1"></span>
                        <span class="focus-input100-2"></span>
                    </div>

                    <input style="padding: 10px;" type="submit" name="submit" value="Submit" class="btn-submit">
                </form>

                <br>

                <table class="table-sort table-sort-search">
                    <thead>
                        <tr class="row100 head">
                            <th class="table-sort">Serial No.</th>
                            <th class="table-sort">Model</th>
                            <th class="table-sort">Color</th>
                            <th class="table-sort">Warehouse</th>
                            <th class="table-sort">Dealership</th>
                            <th class="table-sort">Rebate</th>
                            <th class="table-sort">price</th>
                            <th class="table-sort">type</th>
                            <th class="table-sort">Gas Mileage</th>
                            <th class="table-sort">Seat</th>
                            <th class="table-sort">engine</th>
                        </tr>
                    </thead>


                    <tbody>
                        <?php if(($output2)){
                while($result = mysqli_fetch_assoc($output2)){ ?>
                        <tr class="<?php echo $result['rebate'] ?>">
                            <td><?php echo $result['serial_no']?></td>
                            <td><?php echo $result['model']?></td>
                            <td><?php echo $result['color']?></td>
                            <td><?php echo $result['warehouse']?></td>
                            <td><?php echo $result['dealer']?></td>
                            <td><?php echo $result['rebate']?></td>
                            <td><?php echo $result['price']?></td>
                            <td><?php echo $result['type']?></td>
                            <td><?php echo $result['gas_mileage']?></td>
                            <td><?php echo $result['seat']?></td>
                            <td><?php echo $result['engine']?></td>


                        </tr>


                        <?}}} else{ echo '<span class="login100-form-title p-b-33">No Cars</span>'; echo $dbconnect->error;} ?>






                    </tbody>

                </table>

            </div>
        </div>
    </div>

        <script>

        $(document).ready(function () {
            $('#myCheck').on('change', function(){
                if ($(this).prop('checked')) {
                    $('.No').hide();
                }
                else {
                    $('.No').show();
                }
            });
        });

    </script>

    <footer>
        <h3>All Rights Reserved, Copyright &copy; 2020</h3>
    </footer>
</body>

</html>
